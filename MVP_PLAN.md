# LuloCustoms Shop - MVP Plan

## STATUS: ğŸš§ GOTOWY DO IMPLEMENTACJI (5% UKOÅƒCZONE)

âœ… Konfiguracja projektu zakoÅ„czona
â³ Oczekuje na implementacjÄ™ 23 krokÃ³w

---

## Architektura (SKORYGOWANA)

- **Frontend**: Next.js 16 (Static Export - SSG)
- **Backend**: PHP 8.0+ (API REST)
- **Baza danych**: MySQL 8.0+
- **PÅ‚atnoÅ›ci**: Przelewy24 (Blik + przelewy)
- **Hosting**: Static files (HTML/CSS/JS) + PHP + MySQL

### Dlaczego ta architektura?
âœ… **Hosting wspiera**: Tylko statyczne pliki + PHP + MySQL
âŒ **Hosting NIE wspiera**: Node.js runtime/SSR
âœ… **RozwiÄ…zanie**: Next.js generuje statyczne pliki â†’ upload przez FTP

---

## Struktura na serwerze

```
sklep.lulocustoms.pl/
â”œâ”€â”€ out/                   # Next.js static export (build lokalnie â†’ upload FTP)
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ produkty/
â”‚   â”œâ”€â”€ koszyk/
â”‚   â”œâ”€â”€ zamowienie/
â”‚   â”œâ”€â”€ admin/
â”‚   â””â”€â”€ _next/            # Statyczne assety (CSS, JS)
â”‚
â”œâ”€â”€ api/                   # PHP Backend (upload przez FTP)
â”‚   â”œâ”€â”€ config.php        # Konfiguracja (DB, Przelewy24)
â”‚   â”œâ”€â”€ database.php      # PoÅ‚Ä…czenie z MySQL
â”‚   â”œâ”€â”€ auth.php          # Logowanie admina
â”‚   â”œâ”€â”€ products.php      # CRUD produktÃ³w
â”‚   â”œâ”€â”€ orders.php        # ZamÃ³wienia
â”‚   â””â”€â”€ payment.php       # Przelewy24 webhook
â”‚
â”œâ”€â”€ uploads/              # ZdjÄ™cia produktÃ³w (upload przez admin)
â”‚   â””â”€â”€ products/
â”‚
â””â”€â”€ .htaccess            # Routing (CORS, security headers)
```

---

## Struktura projektu (lokalna)

```
lulocustoms-shop/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js Pages (SSG)
â”‚   â”‚   â”œâ”€â”€ page.tsx           # Strona gÅ‚Ã³wna - lista produktÃ³w
â”‚   â”‚   â”œâ”€â”€ produkty/
â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx   # SzczegÃ³Å‚y produktu
â”‚   â”‚   â”œâ”€â”€ koszyk/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx       # Koszyk
â”‚   â”‚   â”œâ”€â”€ zamowienie/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx       # Checkout
â”‚   â”‚   â”œâ”€â”€ potwierdzenie/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx       # Potwierdzenie po pÅ‚atnoÅ›ci
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â”œâ”€â”€ page.tsx       # Logowanie
â”‚   â”‚       â”œâ”€â”€ produkty/
â”‚   â”‚       â”‚   â””â”€â”€ page.tsx   # ZarzÄ…dzanie produktami
â”‚   â”‚       â””â”€â”€ zamowienia/
â”‚   â”‚           â””â”€â”€ page.tsx   # Lista zamÃ³wieÅ„
â”‚   â”‚
â”‚   â”œâ”€â”€ components/            # Komponenty React
â”‚   â”‚   â”œâ”€â”€ ui/               # Button, Input, Card, Modal
â”‚   â”‚   â”œâ”€â”€ shop/             # ProductCard, CartItem, CheckoutForm
â”‚   â”‚   â””â”€â”€ admin/            # ProductForm, OrderTable, LoginForm
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                  # Utilities (tylko frontend!)
â”‚   â”‚   â”œâ”€â”€ api.ts           # Funkcje do wywoÅ‚aÅ„ PHP API
â”‚   â”‚   â””â”€â”€ cart.ts          # localStorage cart logic
â”‚   â”‚
â”‚   â””â”€â”€ types/               # TypeScript types
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ api/                      # PHP Backend (standalone)
â”‚   â”œâ”€â”€ config.php
â”‚   â”œâ”€â”€ database.php
â”‚   â”œâ”€â”€ auth.php
â”‚   â”œâ”€â”€ products.php
â”‚   â”œâ”€â”€ orders.php
â”‚   â””â”€â”€ payment.php
â”‚
â”œâ”€â”€ database/                 # SQL migrations
â”‚   â”œâ”€â”€ schema.sql           # PeÅ‚ny schemat bazy
â”‚   â””â”€â”€ seed.sql             # PrzykÅ‚adowe dane (opcjonalnie)
â”‚
â”œâ”€â”€ public/                   # Pliki statyczne
â”‚   â””â”€â”€ images/
â”‚
â””â”€â”€ out/                      # Generated by `npm run build` (upload to FTP)
```

---

## FunkcjonalnoÅ›ci MVP

### 1. SKLEP (dla klientÃ³w)
- [ ] Lista wszystkich produktÃ³w (SSG - generowane podczas build)
- [ ] SzczegÃ³Å‚y produktu (zdjÄ™cie, opis, cena)
- [ ] Koszyk (localStorage - dziaÅ‚a offline)
- [ ] Checkout (formularz: imiÄ™, email, telefon, adres)
- [ ] PÅ‚atnoÅ›Ä‡ przez Przelewy24 (Blik + przelewy bankowe)
- [ ] Strona potwierdzenia zamÃ³wienia

### 2. PANEL ADMINA
- [ ] Logowanie (email + hasÅ‚o â†’ PHP session)
- [ ] Lista produktÃ³w (pobierana z API PHP)
- [ ] Dodawanie produktu (nazwa, opis, cena, upload zdjÄ™cia)
- [ ] Edycja produktu
- [ ] Usuwanie produktu
- [ ] Lista zamÃ³wieÅ„ (status pÅ‚atnoÅ›ci, dane klienta, produkty)

### 3. BAZA DANYCH (4 tabele)

```sql
-- Tabela 1: Administratorzy
admin_users:
- id (INT, PRIMARY KEY, AUTO_INCREMENT)
- email (VARCHAR(255), UNIQUE)
- password_hash (VARCHAR(255))
- created_at (DATETIME)

-- Tabela 2: Produkty
products:
- id (INT, PRIMARY KEY, AUTO_INCREMENT)
- name (VARCHAR(255))
- description (TEXT)
- price (DECIMAL(10,2))
- image_url (VARCHAR(500))
- stock (INT, DEFAULT 0)
- active (BOOLEAN, DEFAULT true)
- created_at (DATETIME)
- updated_at (DATETIME)

-- Tabela 3: ZamÃ³wienia
orders:
- id (INT, PRIMARY KEY, AUTO_INCREMENT)
- order_number (VARCHAR(50), UNIQUE)
- customer_name (VARCHAR(255))
- customer_email (VARCHAR(255))
- customer_phone (VARCHAR(20))
- customer_address (TEXT)
- total_price (DECIMAL(10,2))
- payment_status (ENUM: 'pending', 'paid', 'failed')
- p24_transaction_id (VARCHAR(100))
- created_at (DATETIME)

-- Tabela 4: Pozycje zamÃ³wienia
order_items:
- id (INT, PRIMARY KEY, AUTO_INCREMENT)
- order_id (INT, FOREIGN KEY â†’ orders.id)
- product_id (INT)
- product_name (VARCHAR(255))  -- snapshot na wypadek usuniÄ™cia produktu
- product_price (DECIMAL(10,2)) -- snapshot ceny z momentu zakupu
- quantity (INT)
```

### 4. BEZPIECZEÅƒSTWO

- [ ] **SQL Injection**: Prepared statements w PHP (PDO)
- [ ] **Password**: bcrypt hashing (PHP password_hash)
- [ ] **Session**: Secure PHP sessions (httponly, secure, samesite)
- [ ] **XSS**: Input validation + htmlspecialchars w PHP
- [ ] **CSRF**: Token validation dla POST requestÃ³w
- [ ] **CORS**: .htaccess headers (tylko sklep.lulocustoms.pl)
- [ ] **HTTPS**: Force HTTPS w .htaccess
- [ ] **File Upload**: Walidacja typu/rozmiaru zdjÄ™Ä‡
- [ ] **Rate Limiting**: Ochrona przed brute force (login, API)

---

## Czego NIE MA w MVP (v2.0+)

- Rejestracja klientÃ³w (kupujÄ… jako goÅ›cie)
- Konto klienta / historia zamÃ³wieÅ„
- Kategorie produktÃ³w
- Filtry i wyszukiwarka
- Warianty produktÃ³w (rozmiary, kolory)
- Recenzje produktÃ³w
- Newsletter
- Kody rabatowe
- Åšledzenie przesyÅ‚ek
- Zaawansowane statystyki
- Multi-language

---

## Plan realizacji (23 kroki)

### ETAP 1: BAZA DANYCH (3 kroki)
1. [x] **UtworzyÄ‡ schemat bazy MySQL** (`database/schema.sql`)
   - 4 tabele: admin_users, products, orders, order_items
   - Indeksy, foreign keys, defaults
2. [ ] **NapisaÄ‡ skrypt seed** (`database/seed.sql`)
   - Pierwsze konto admina (email + hasÅ‚o)
   - 3-5 przykÅ‚adowych produktÃ³w do testÃ³w
3. [ ] **PrzygotowaÄ‡ dokumentacjÄ™ setup bazy**
   - Instrukcje import SQL przez phpMyAdmin
   - Jak zmieniÄ‡ pierwsze hasÅ‚o admina

### ETAP 2: PHP BACKEND (7 krokÃ³w)
4. [ ] **config.php** - Konfiguracja
   - Dane poÅ‚Ä…czenia MySQL (z phpMyAdmin)
   - Klucze Przelewy24 (sandbox mode)
   - Security settings (session, CORS)
5. [ ] **database.php** - PoÅ‚Ä…czenie z bazÄ…
   - PDO connection z error handling
   - Prepared statements helper functions
6. [ ] **auth.php** - Autentykacja admina
   - POST /api/auth.php?action=login
   - POST /api/auth.php?action=logout
   - GET /api/auth.php?action=check (czy zalogowany)
7. [ ] **products.php** - CRUD produktÃ³w
   - GET /api/products.php (lista wszystkich)
   - GET /api/products.php?id=X (pojedynczy)
   - POST /api/products.php (dodaj - tylko admin)
   - PUT /api/products.php (edytuj - tylko admin)
   - DELETE /api/products.php?id=X (usuÅ„ - tylko admin)
   - Upload zdjÄ™Ä‡ do /uploads/products/
8. [ ] **orders.php** - ZamÃ³wienia
   - POST /api/orders.php (utwÃ³rz zamÃ³wienie)
   - GET /api/orders.php (lista - tylko admin)
   - GET /api/orders.php?id=X (szczegÃ³Å‚y - tylko admin)
9. [ ] **payment.php** - Przelewy24
   - POST /api/payment.php?action=init (inicjalizacja pÅ‚atnoÅ›ci)
   - POST /api/payment.php?action=verify (webhook P24)
   - POST /api/payment.php?action=status (sprawdÅº status)
10. [ ] **.htaccess** - Security & Routing
    - Force HTTPS
    - CORS headers
    - Zabezpieczenia (block .env, .git, etc.)

### ETAP 3: FRONTEND - KOMPONENTY UI (2 kroki)
11. [ ] **Podstawowe komponenty** (`src/components/ui/`)
    - Button.tsx (primary, secondary, danger)
    - Input.tsx (text, email, number)
    - Card.tsx (kontener produktu)
    - Modal.tsx (dialogi)
    - Spinner.tsx (loading state)
12. [ ] **TypeScript types** (`src/types/index.ts`)
    - Product, Order, OrderItem, Admin
    - API Response types
    - Cart types (localStorage)

### ETAP 4: FRONTEND - SKLEP (5 krokÃ³w)
13. [ ] **Strona gÅ‚Ã³wna** (`src/app/page.tsx`)
    - Fetch produktÃ³w z API PHP
    - Grid produktÃ³w (ProductCard)
    - "Dodaj do koszyka" button
14. [ ] **SzczegÃ³Å‚y produktu** (`src/app/produkty/[id]/page.tsx`)
    - Fetch pojedynczego produktu
    - Galeria zdjÄ™Ä‡
    - Opis, cena, stock
    - "Dodaj do koszyka"
15. [ ] **Koszyk** (`src/app/koszyk/page.tsx`)
    - Odczyt z localStorage
    - Lista produktÃ³w w koszyku
    - Zmiana iloÅ›ci, usuwanie
    - Suma zamÃ³wienia
    - Przycisk "PrzejdÅº do kasy"
16. [ ] **Checkout** (`src/app/zamowienie/page.tsx`)
    - Formularz: imiÄ™, email, telefon, adres
    - Walidacja (react-hook-form + zod)
    - Podsumowanie zamÃ³wienia
    - Inicjalizacja pÅ‚atnoÅ›ci P24
    - Redirect do Przelewy24
17. [ ] **Potwierdzenie** (`src/app/potwierdzenie/page.tsx`)
    - Weryfikacja pÅ‚atnoÅ›ci (query params z P24)
    - WyÅ›wietl potwierdzenie lub bÅ‚Ä…d
    - WysyÅ‚ka email (opcjonalnie)

### ETAP 5: FRONTEND - PANEL ADMINA (3 kroki)
18. [ ] **Logowanie** (`src/app/admin/page.tsx`)
    - Formularz email + hasÅ‚o
    - WywoÅ‚anie PHP auth.php
    - Zapisanie sesji (localStorage token lub cookie)
    - Redirect do /admin/produkty
19. [ ] **ZarzÄ…dzanie produktami** (`src/app/admin/produkty/page.tsx`)
    - Sprawdzenie czy zalogowany (middleware?)
    - Lista produktÃ³w (tabela)
    - Modal dodawania/edycji
    - Upload zdjÄ™cia (FormData)
    - Usuwanie (confirmation dialog)
20. [ ] **Lista zamÃ³wieÅ„** (`src/app/admin/zamowienia/page.tsx`)
    - Tabela zamÃ³wieÅ„
    - Filtry: status, data
    - PodglÄ…d szczegÃ³Å‚Ã³w (modal)
    - Zmiana statusu (opcjonalnie)

### ETAP 6: FINALIZACJA (3 kroki)
21. [ ] **Walidacja i zabezpieczenia**
    - Testy wszystkich API endpoints
    - Sprawdzenie XSS/CSRF/SQL injection
    - Rate limiting na login
    - Walidacja uploadowanych plikÃ³w
22. [ ] **Dokumentacja deployment**
    - README: jak zbudowaÄ‡ lokalnie
    - Instrukcje FTP upload
    - Setup bazy danych
    - Konfiguracja Przelewy24
    - Zmienne Å›rodowiskowe (.htaccess)
23. [ ] **Testing & Deploy**
    - Test peÅ‚nego flow: przeglÄ…danie â†’ koszyk â†’ pÅ‚atnoÅ›Ä‡
    - Test panelu admina
    - Upload na hosting przez FTP
    - Test na produkcji

---

## Deployment

### 1. Lokalne budowanie:

```bash
# Instalacja dependencies
npm install

# Development (z hot reload)
npm run dev

# Production build (generuje statyczne pliki)
npm run build
# â†‘ Tworzy folder /out z HTML/CSS/JS
```

### 2. Upload na hosting (FTP):

**Co uploadowaÄ‡:**
1. **ZawartoÅ›Ä‡ folderu `out/`** â†’ gÅ‚Ã³wny katalog domeny (public_html lub httpdocs)
2. **Folder `api/`** â†’ obok `out/` (na tym samym poziomie)
3. **Folder `uploads/`** â†’ obok `api/` (z prawami zapisu 755)
4. **Plik `.htaccess`** â†’ gÅ‚Ã³wny katalog

**Struktura koÅ„cowa na FTP:**
```
public_html/
â”œâ”€â”€ index.html           # z out/
â”œâ”€â”€ produkty/            # z out/
â”œâ”€â”€ _next/               # z out/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ config.php
â”‚   â”œâ”€â”€ database.php
â”‚   â””â”€â”€ ...
â”œâ”€â”€ uploads/
â”‚   â””â”€â”€ products/
â””â”€â”€ .htaccess
```

### 3. Konfiguracja bazy MySQL:

1. WejdÅº do phpMyAdmin (panel hostingu)
2. UtwÃ³rz nowÄ… bazÄ™: `lulocustoms_shop`
3. Import pliku: `database/schema.sql`
4. (Opcjonalnie) Import: `database/seed.sql`
5. Zapisz dane dostÄ™powe (host, user, password, nazwa bazy)

### 4. Konfiguracja PHP:

Edytuj `api/config.php` na serwerze:

```php
// Dane MySQL (z phpMyAdmin)
define('DB_HOST', 'localhost');
define('DB_NAME', 'lulocustoms_shop');
define('DB_USER', 'twoj_user');
define('DB_PASS', 'twoje_haslo');

// Przelewy24 (sandbox â†’ potem production)
define('P24_MERCHANT_ID', 'xxxxx');
define('P24_POS_ID', 'xxxxx');
define('P24_CRC', 'xxxxxxxx');
define('P24_TEST_MODE', true);  // false na produkcji
```

### 5. Konfiguracja Przelewy24:

1. Zarejestruj konto na https://przelewy24.pl
2. PrzejdÅº do panelu â†’ **Moje dane** â†’ **Sklepy i Stanowiska**
3. Uzyskaj:
   - **Merchant ID** (ID Sprzedawcy)
   - **POS ID** (ID Stanowiska)
   - **CRC** (Klucz do raportÃ³w)
   - **API Key** (opcjonalnie, dla API)
4. Ustaw **URL powrotu**: `https://sklep.lulocustoms.pl/potwierdzenie`
5. Ustaw **Webhook URL**: `https://sklep.lulocustoms.pl/api/payment.php?action=verify`
6. Najpierw testuj w **trybie sandbox** (P24_TEST_MODE = true)
7. Po testach â†’ aktywuj konto â†’ zmieÅ„ na tryb produkcyjny

### 6. Pierwsze logowanie:

```
Email: admin@lulocustoms.pl
HasÅ‚o: (hasÅ‚o z seed.sql - ZMIEÅƒ natychmiast po pierwszym logowaniu!)
```

---

## Wymagania techniczne

**Na hostingu:**
- PHP 8.0+
- MySQL 8.0+
- mod_rewrite (Apache)
- HTTPS (SSL certificate)
- min 100MB miejsca
- phpMyAdmin (do zarzÄ…dzania bazÄ…)

**Lokalnie (development):**
- Node.js 18+
- npm lub yarn
- Edytor kodu (VS Code)

---

## BezpieczeÅ„stwo - Checklist

- [ ] HasÅ‚a hashowane przez `password_hash()` (bcrypt)
- [ ] Prepared statements (PDO) - zero konkatenacji SQL
- [ ] Session security (httponly, secure, samesite)
- [ ] CSRF tokens na wszystkich formularzach
- [ ] XSS protection (`htmlspecialchars()` w PHP)
- [ ] Input validation (PHP + Zod frontend)
- [ ] File upload validation (typ, rozmiar, rozszerzenie)
- [ ] Rate limiting na login endpoint
- [ ] HTTPS only (redirect w .htaccess)
- [ ] Blocked access do .env, .git, config files
- [ ] CORS tylko dla sklep.lulocustoms.pl
- [ ] Secrets w config.php poza document root (jeÅ›li moÅ¼liwe)

---

## Czas realizacji

**Szacowany czas**: 1-2 dni robocze dla doÅ›wiadczonego dewelopera
**MVP**: Wszystkie 23 kroki moÅ¼na wykonaÄ‡ w 2-3 sesjach po 4-6h

**Priorytet implementacji:**
1. Backend + Baza (kroki 1-10) â†’ 40% czasu
2. Frontend sklep (kroki 11-17) â†’ 35% czasu
3. Panel admin (kroki 18-20) â†’ 15% czasu
4. Finalizacja (kroki 21-23) â†’ 10% czasu

---

## NastÄ™pne kroki (v2.0)

Po ukoÅ„czeniu MVP, w kolejnych wersjach:
- Konta uÅ¼ytkownikÃ³w
- Historia zamÃ³wieÅ„ dla klientÃ³w
- Kategorie i filtry produktÃ³w
- Warianty produktÃ³w (rozmiary, kolory)
- System recenzji
- Newsletter (Mailchimp/SendGrid)
- Kody rabatowe
- Åšledzenie przesyÅ‚ek (integracja z kurierami)
- Statystyki sprzedaÅ¼y (dashboard admina)
- Multi-language (PL/EN)
- PWA (Progressive Web App)
